/**
 * jquery.scrollless.affixnav
 * Contents navigation for jquery.scrollless
 * 
 * @version  1.0.0
 * @requires jquery.scrollless
 * @author   Savr Goryaev (savreen.com/contact/)
 * @license  GPL v2 http://opensource.org/licenses/GPL-2.0
 */

(function(e){function T(t){if(!this||!N(t)||!u||!this.find("."+u).length){k();return}f=true;if(!c){l=this;c=e(s).html(i);this.wrap(o).parent().after(c)}c.show()}function N(e){if(!e||typeof e!="object")return false;e.attachItemData=true;if(!("affixnav"in e))return true;if("disable"in e.affixnav)return false;if("classHeader"in e.affixnav)u=e.affixnav.classHeader;if("classHeaderLevel"in e.affixnav)a=e.affixnav.classHeaderLevel;return true}function C(t,n){if(!f||!c||!t||!t.length)return;var i="scrollless-item";h=t.length;m.length=g.length=0;g.length=h;var s=[];var o=this.find("."+u);var l=[];p=o.length;for(var w=0;w<p;w++){var E=o.eq(w),S;var x=E.hasClass(i)?E:(S=E.parents("."+i)).length||(S=E.find("."+i)).length?S.eq(0):0;if(!x)continue;for(var T=0;T<5&&!E.hasClass(a+(T+1));T++);var N=T<5?T:0;var C=x.data("iItem");if(g[C]==undefined)g[C]=m.length;m.push(C);l.push(N);s.push(E.text())}var k=e(r);var L=c.children("ul").eq(0).empty();var A=0;c.children().each(function(){A+=e(this).height()});var O=[];for(w=0;w<p;w++){var M=k.clone().html(s[w]).addClass(a+(l[w]+1)).data("iHeader",w).appendTo(L);O[w]=c.height()-A;M.hide()}b=A+1;y=O;d=L.children().on("click",_);if(!v){v=c.find(".affixnav-elps > span")}}function k(){if(!f||!c)return;f=false;c.hide()}function L(e){if(!f||typeof e!="object")return;if(!e.sizing){x=false;w=e.height}else if(!x){x=true;M()}}function A(e){if(!f||typeof e!="object")return;var t=e.start,n=e.end,r;if(g[t]!=undefined)E=g[t];else{for(r=t-1;r>=0&&g[r]==undefined;r--);E=r>=0?g[r]:0}if(g[n]!=undefined)S=g[n];else{for(r=n+1;r<h&&g[r]==undefined;r++);S=r<h?g[r]:p}O()}function O(){var e=w-b;var t=0,n,r;for(n=E;n<S&&t+y[n]<e;n++)t+=y[n];var i=true;for(n=S,r=E-1;i;){var s,o;if(s=n<h&&t+y[n]<e)t+=y[n++];if(o=r>=0&&t+y[r]<e)t+=y[r--];i=s||o}var u=r<E-1?r+1:E,a=n;d.removeClass("affixnav-cursor").slice(E,S).addClass("affixnav-cursor");d.hide().slice(u,a).show();D(0,u);D(1,a<p-1)}function M(){d.hide();D(0,0);D(1,0)}function _(t){t.preventDefault();var n=e(this).data("iHeader");var r=m[n];e.scrollless.setPos(r)}function D(e,t){v.eq(e).css("visibility",t?"visible":"hidden")}e.scrollless.on("preInit",T).on("postInit",C).on("disable",k).on("changeSize",L).on("changePos",A);var t='<div class="affixnav-elps"><span></span></div>';var n='<div class="affixnav-spacer"></div>';var r="<li></li>";var i=t+n+"<ul></ul>"+n+t;var s='<td class="affixnav"></td>';var o='<table class="affixnav-wrap"><tr><td></td></tr></table>';var u="affixnav-header";var a="level";var f=false;var l=0;var c=0;var h=0;var p=0;var d=0;var v=0;var m=[];var g=[];var y=[];var b=0;var w=0;var E=0;var S=0;var x=false})(jQuery)