/**
 * jquery.scrollless.pagenav
 * Page navigation for jquery.scrollless
 * 
 * @version  1.0.0
 * @requires jquery.scrollless
 * @author   Savr Goryaev (savreen.com/contact/)
 * @license  GPL v2 http://opensource.org/licenses/GPL-2.0
 */

(function(e){function w(t){if(!this||!E(t)){x();return}u=true;if(!a){a=e(r);a.html(n).insertBefore(this)}a.show()}function E(e){if(!e||typeof e!="object")return false;e.attachItemData=true;if(!("pagenav"in e))return true;if("disable"in e.pagenav)return false;if("quota"in e.pagenav)s=Math.floor(Number(e.pagenav.quota));if("nThumbs"in e.pagenav)i=Math.floor(Number(e.pagenav.nThumbs));if("classPageBreak"in e.pagenav)o=e.pagenav.classPageBreak;return true}function S(n,r){if(!u||!a||!n||!n.length)return;var y=n.length;var w="scrollless-item";var E=this.find("."+o),S=E.length;var x=[],T=[];for(var k=0;k<S;k++){var L=E.eq(k),A;var O=L.hasClass(w)?L:(A=L.find("."+w)).length?A.eq(0):0;if(!O)continue;var M=O.data("iItem");if(!M)continue;T[M]=true;x.push(M)}var _=x.length;p.length=d.length=v.length=m.length=0;var D=0,P=0;var H=[],B=[];for(k=0;k<y;k++){v.push(P);P+=r[k];var j=n.eq(k).text().length;H.push(j);var F=_&&T[k]!=undefined||(D+=j)>s;if(F){p.push(k);B.push(D>s?D-j:D);D=D>s?j:0}d[k]=p.length}v.push(P);h=p.push(n.length);p.unshift(0);d.push(h-1);B.push(D);for(var I=0,q=0,R=0;R<_;R++,I=q){var U=x[R];q=d[U];if(q-I<2)continue;I=q-2;var z=q-1,W=B[z],X=B[I];if(X<=W)continue;var V=Math.floor((X+W)/2),J=V-W,K=p[z],Q=p[I];for(D=0,k=K-1;k>=Q&&D+H[k]<J;k--){var G=H[k];D+=G;d[k]=z;B[z]+=G;B[I]-=G}if(k<K-1)p[z]=k+1}if(i%2==0)i++;i=Math.max(Math.min(i,h),1);b=i<h?Math.floor(i/2):h;a.find(".pagenav-thumb").remove();var Y=e(t);var Z=a.find(".pagenav-before-thumb");for(k=0;k<i;k++){Y.clone().html(i-k).insertAfter(Z)}f=a.find(".pagenav-thumb").on("click",N);g=f.eq(0).width();for(k=0;k<i;k++){m[k]=f.eq(k).data("iThumb",k).position().left}c=a.find(".pagenav-cursor").eq(0);if(!l){l=a.find(".pagenav-arrow").on("click",C);l.eq(0).data("arrowtype",0);l.eq(1).data("arrowtype",1)}l.eq(1).children().eq(1).html(h)}function x(){if(!u||!a)return;u=false;a.hide()}function T(e){if(!u||typeof e!="object")return;var t=e.start,n=e.end;var r=d[t],s=d[n];var o=p[r],a=p[s];var l=p[r+1],w=p[s+1];var E=r<b?r:r>=h-b?b+h-r:b;var S=Math.min(E+s-r,i-1);y=r-E;var x=v[t],T=v[n];var N=v[o],C=v[l];var L=v[a],A=v[w];var O=Math.round(g*(x-N)/(C-N));var M=Math.round(g*(T-L)/(A-L));var _=m[E]+O;var D=m[S]+(E+s-r<i?M:g);var P=D-_;c.css("left",_);c.css("width",P);k(0,y);k(1,y+i<h);for(var H=0;H<i;H++){f.eq(H).html(y+H+1)}}function N(t){t.preventDefault();var n=Number(e(this).data("iThumb"));if(isNaN(n))return;var r=a.offset().left;var i=t.pageX-r-m[n];var s=y+n;var o=p[s],u=p[s+1];var f=v[o],l=v[u];var c=f+Math.round(i/g*(l-f));for(var h=u-1;h>=0&&v[h]>=c;h--);var d=h;e.scrollless.setPos({pos:d,left:o,right:u})}function C(t){t.preventDefault();var n=Boolean(e(this).data("arrowtype"));e.scrollless.setPos(p[n?h-1:0])}function k(e,t){l.eq(e).css("visibility",t?"visible":"hidden")}e.scrollless.on("preInit",w).on("postInit",S).on("disable",x).on("changePos",T);var t='<div class="pagenav-thumb"></div>';var n="<div>"+'<div class="pagenav-cursor">&nbsp;</div>'+'<div class="pagenav-arrow pagenav-before-thumb"><span>1</span><span class="arrow-left"></span></div>'+'<div class="pagenav-arrow"><span class="arrow-right"></span><span></span></div>'+'<div class="pagenav-clear"></div>'+"</div>";var r='<div class="pagenav"></div>';var i=3;var s=2e3;var o="pagenav-break";var u=false;var a=0;var f=0;var l=0;var c=0;var h=0;var p=[];var d=[];var v=[];var m=[];var g=0;var y=0;var b=0})(jQuery)